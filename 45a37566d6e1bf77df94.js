(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{1837:function(t,e,n){"use strict";n.r(e);n(211),n(223),n(32),n(22),n(65),n(488),n(134),n(210),n(42);var r,o,c,l=n(8),h=n(135),d=n.n(h),m={name:"StarHistory",components:{VeLine:n(1648)},head:function(){return this.$store.state.currentTool.head},data:function(){return{repo:"",token:"",loading:!1,sampleNum:15,chartData:{columns:["date","starNum"],rows:[]},chartExtend:{legend:{show:!1}},chartSettings:{legend:{show:!1},xAxisType:"time"}}},methods:{query:(c=Object(l.a)(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.loading=!0,this.chartData.rows=[],this.repo.includes("github.com")?(this.repo+="/",this.repo=/github\.com\/(\S*?\/\S*?)[\/#?]/.exec(this.repo)[1]):this.repo=""==this.repo?"Ice-Hazymoon/MikuTools":this.repo,!(e=this.$db.get('tool.star_history["'.concat(this.repo,'"]')).value())){t.next=9;break}this.loading=!1,this.chartData.rows=e,t.next=22;break;case 9:return t.prev=9,t.next=12,this.getStarHistory(this.repo,this.token?this.token:void 0);case 12:n=t.sent,this.loading=!1,this.chartData.rows=n,this.$db.set('tool.star_history["'.concat(this.repo,'"]'),n).write(),t.next=22;break;case 18:t.prev=18,t.t0=t.catch(9),this.loading=!1,t.t0.message.indexOf("403")>=0?this.$swal({type:"error",title:"获取失败",text:"ERROR: 请求次数过多，请填写 Token 以获取更多配额"}):this.$swal({type:"error",title:"获取失败",text:"ERROR: ".concat(t.t0)});case 22:case"end":return t.stop()}}),t,this,[[9,18]])}))),function(){return c.apply(this,arguments)}),range:function(t){return Array.apply(null,{length:t}).map((function(t,i){return i+1}))},generateUrls:(o=Object(l.a)(regeneratorRuntime.mark((function t(e,n){var r,o,c,link,l,h,m,f=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=d.a.create({headers:{Accept:"application/vnd.github.v3.star+json"},params:{access_token:n}}),o="https://api.github.com/repos/".concat(e,"/stargazers"),t.next=4,r.get(o,{auth:!1,headers:{Accept:"application/vnd.github.v3.star+json"},params:{access_token:n}});case 4:return c=t.sent,link=c.headers.link,l=link?/next.*?page=(\d*).*?last/.exec(link)[1]:1,h=l<=this.sampleNum?this.range(l).slice(1,l):this.range(this.sampleNum).map((function(t){return Math.round(t/f.sampleNum*l)-1})),m=h.map((function(t){return"".concat(o,"?page=").concat(t)})),t.abrupt("return",{firstPage:c,sampleUrls:m,pageIndexes:h});case 10:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)}),getStarHistory:(r=Object(l.a)(regeneratorRuntime.mark((function t(e,n){var r,o,c,l,h,m,f,v,w,y,k,x,_,D,R,A,S;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=d.a.create({headers:{Accept:"application/vnd.github.v3.star+json"},params:{access_token:n}}),t.next=3,this.generateUrls(e,n);case 3:return o=t.sent,c=o.sampleUrls,l=o.pageIndexes,h=o.firstPage,m=[h].concat(c.map((function(t){return r.get(t,{auth:!1,headers:{Accept:"application/vnd.github.v3.star+json"},params:{access_token:n}})}))),t.next=10,Promise.all(m);case 10:return f=t.sent,v=null,l[l.length-1]>this.sampleNum?v=l.map((function(p,i){return{date:f[i+1].data[0].starred_at.slice(0,10),starNum:30*(p-1)}})):(w=f.reduce((function(t,e){return t.concat(e.data)}),[]),y=new Date(w[0].starred_at),k=Math.round(new Date-y)/864e5,x=Array.from(new Array(50)).map((function(t,i){var e=new Date(y);return e.setDate(e.getDate()+Math.floor(k/50*(i+1))),e.toISOString().slice(0,10)}),[]),v=x.map((function(t){var e=0,n=w.find((function(n,i){return n.starred_at.slice(0,10)>=t&&(e=i+1,!0)}));return n&&{date:n.starred_at.slice(0,10),starNum:e}})).filter((function(t){return t}))),t.next=15,r.get("https://api.github.com/repos/".concat(e),{auth:!1,headers:{Accept:"application/vnd.github.v3.star+json"},params:{access_token:n}});case 15:return _=t.sent,D=_.data.stargazers_count,R=new Date,A=R.getMonth()+1>10?R.getMonth()+1:"0".concat(R.getMonth()+1),S=R.getDate()>10?R.getDate():"0".concat(R.getDate()),v.push({date:"".concat(R.getFullYear(),"-").concat(A,"-").concat(S),starNum:D}),t.abrupt("return",v);case 22:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})}},f=n(3),component=Object(f.a)(m,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"star_history"},[n("nya-container",{attrs:{title:"Star 历史查询"}},[n("nya-input",{staticClass:"mb-15",attrs:{disabled:t.loading,label:"请输入GitHub项目地址",placeholder:"https://github.com/Ice-Hazymoon/MikuTools",autocomplete:"off",autofocus:"",fullwidth:""},model:{value:t.repo,callback:function(e){t.repo="string"==typeof e?e.trim():e},expression:"repo"}}),t._v(" "),n("nya-input",{staticClass:"mb-15",attrs:{disabled:t.loading,label:"Access Token",placeholder:"私有仓库或访问超过限制则必填",autocomplete:"off",fullwidth:""},model:{value:t.token,callback:function(e){t.token="string"==typeof e?e.trim():e},expression:"token"}}),t._v(" "),n("button",{staticClass:"nya-btn",attrs:{type:"button",disabled:t.loading},on:{click:t.query}},[t._v("\n            "+t._s(t.loading?"获取中":"开始获取")+"\n        ")])],1),t._v(" "),t.chartData.rows.length?n("nya-container",{attrs:{title:"查询结果"}},[n("client-only",[n("ve-line",{attrs:{data:t.chartData,settings:t.chartSettings,extend:t.chartExtend}})],1)],1):t._e()],1)}),[],!1,null,null,null);e.default=component.exports}}]);